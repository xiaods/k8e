on:
  pull_request:
    branches:
      - master
name: Build Test
jobs:
  build:
    name: Build & Test
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        include:
          - goarch: amd64
            goos: linux
    env:
      GOOS: ${{ matrix.goos }}
      GOARCH: ${{ matrix.goarch }}
    steps:
    - uses: actions/checkout@v2
      with:
        ref: 'dev'
    - uses: actions/setup-go@v2
      with:
        go-version: 1.16
    - name: generate resources
      run: mkdir -p {build/data,build/static} && go generate
    - name: Test
      id: gotest
      run: |
        export GOPATH="$HOME/go/"
        export PATH=$PATH:$GOPATH/bin
        go install github.com/rakyll/gotest@latest
        go generate ./...
        echo "::set-output name=GREET::$(gotest -v ./...)"
    - name: Comment PR
      uses: thollander/actions-comment-pull-request@v1
      with:
        message: |
          ```
            ${{ steps.gotest.outputs.GREET }}
          ```
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}